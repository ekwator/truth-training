Анализ функциональности модуля P2P
Модуль p2p реализует peer-to-peer функциональность для приложения "Truth Training":
Компоненты модуля P2P:
encryption.rs - Криптографическая идентичность:
CryptoIdentity - структура для управления ключами Ed25519
new() - генерация новой пары ключей
sign() - подписание данных
verify() - проверка подписи
public_key_hex() - получение публичного ключа в hex
node.rs - P2P узел:
Node - структура узла с списком пиров, БД и крипто-идентичностью
start() - запуск периодической синхронизации с пирами (каждые 30 сек)
sync.rs - Синхронизация с пирами:
sync_with_peer() - асинхронная синхронизация с конкретным пиром
Подписывает запросы и проверяет ответы
net.rs - Сетевое обнаружение:
UDP маяки для обнаружения других узлов в локальной сети
run_beacon_sender() - отправка маяков каждые 7 сек
run_beacon_listener() - прослушивание маяков от других узлов
Список серверных API команд
Вот полный список реализованных серверных API endpoints:
1. GET /health
Описание: Проверка состояния сервера
Ответ: 200 OK с телом "OK"
Использование: Мониторинг доступности сервера
2. GET /statements
Описание: Получение списка всех утверждений (заглушка)
Ответ: 200 OK с JSON массивом строк (пока пустой)
Статус: TODO - требует реализации в core_lib
3. POST /statements
Описание: Добавление нового утверждения (заглушка)
Тело запроса:
Ответ: 200 OK с JSON строкой "TODO"
Статус: TODO - требует реализации в core_lib
4. GET /events
Описание: Получение списка всех событий истины с криптографической аутентификацией
Заголовки:
X-Public-Key: hex-кодированный публичный ключ Ed25519
X-Signature: hex-кодированная подпись сообщения
Аутентификация: Проверяет подпись сообщения sync_request:{timestamp}
Ответ:
200 OK с JSON массивом событий при успешной аутентификации
401 Unauthorized при неверной подписи
Использование: P2P синхронизация между узлами
5. POST /events
Описание: Добавление нового события истины
Тело запроса:
Ответ: 200 OK с JSON объектом {"id": "event_id"}
Автоматически устанавливает: code: 1, timestamp_start: текущее время
6. POST /impacts
Описание: Добавление нового воздействия к событию
Тело запроса: JSON объект Impact:
Ответ: 200 OK с JSON объектом {"id": "impact_id"}
Особенности реализации:
Асинхронность: Все endpoints используют actix-web с асинхронными обработчиками
База данных: Использует web::block для блокирующих операций с SQLite
P2P безопасность: Endpoint /events требует криптографической аутентификации
Обработка ошибок: Детальные сообщения об ошибках для отладки
Типизация: Строгая типизация с serde для сериализации/десериализации
Резюме
✅ Исправлена ошибка с SigningKey::generate - модуль p2p/encryption.rs теперь корректно компилируется
✅ Проверена функциональность модуля P2P - модуль включает:
Криптографическую идентичность (Ed25519)
P2P узел с периодической синхронизацией
Сетевое обнаружение через UDP маяки
Безопасную синхронизацию между пирами
✅ Создан полный список серверных API команд - 6 endpoints:
GET /health - проверка состояния
GET /statements - получение утверждений (заглушка)
POST /statements - добавление утверждений (заглушка)
GET /events - получение событий с P2P аутентификацией
POST /events - добавление событий истины
POST /impacts - добавление воздействий
Модуль P2P полностью функционален и интегрирован в основное приложение для обеспечения децентрализованной синхронизации данных между узлами.